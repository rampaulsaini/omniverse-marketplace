<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Omniverse Marketplace — Local Demo</title>
  <style>
    :root {
      --bg:#071025; --card:#081425; --muted:#98a0b3; --accent:#60a5fa;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071025 0%, #021029 100%);color:#e6eef8}
    .wrap{max-width:1100px;margin:18px auto;padding:16px;display:grid;grid-template-columns:320px 1fr;gap:16px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border:1px solid var(--glass); padding:12px; border-radius:10px}
    .small{font-size:13px;color:var(--muted)}
    .muted{color:var(--muted)}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;color:#e6eef8;cursor:pointer}
    input, textarea, select {width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef8}
    label{display:block;font-size:13px;margin:6px 0 4px;color:var(--muted)}
    .tools-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .tool-row{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    .tool-row .meta{font-size:12px;color:var(--muted)}
    .right-col{display:grid;grid-template-rows:auto 1fr;gap:12px}
    .flex{display:flex;gap:8px;align-items:center}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .editor{display:grid;grid-template-columns:1fr 320px;gap:12px}
    pre{background:#071425;padding:12px;border-radius:8px;overflow:auto;font-size:13px}
    .big-btn{padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#3b82f6);border:0;color:#07203a;font-weight:600;cursor:pointer}
    footer{text-align:center;margin-top:12px;color:var(--muted);font-size:13px}
    .stat-badge{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:999px;font-size:13px;border:1px solid rgba(255,255,255,0.03)}
    .danger{color:#ff9b9b}
    .hint{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px}
    .grow{flex:1}
    @media (max-width:900px){.wrap{grid-template-columns:1fr;}.editor{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div style="max-width:1100px;margin:8px auto;padding:12px">
    <header>
      <div>
        <h1>Omniverse Marketplace — Local Demo</h1>
        <div class="small">Zero-cost · Donation-ready · Settings &amp; stats local to your browser</div>
      </div>
      <div style="margin-left:auto" class="flex">
        <div class="stat-badge" id="usesBadge">Uses: 0</div>
        <div class="stat-badge" id="dlBadge">Downloads: 0</div>
      </div>
    </header>
  </div>

  <div class="wrap">
    <!-- LEFT COLUMN: Controls + Tools list -->
    <div>
      <div class="card">
        <strong>Owner Settings (Local)</strong>
        <div class="small">Owner settings केवल आपके ब्राउज़र में सुरक्षित रहते हैं।</div>
        <label>Owner name</label>
        <input id="ownerName" placeholder="आपका नाम (Owner)" />
        <label>Donate / Pay links (comma separated)</label>
        <input id="ownerLinks" placeholder="upi:abc@bank, https://paypal.me/you, https://ko-fi.com/you" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveOwner">Save Settings</button>
          <button id="exportOwner">Export</button>
          <button id="importOwner">Import</button>
        </div>
        <hr style="margin:10px 0;border-color:rgba(255,255,255,0.03)">
        <strong>Marketplace Controls</strong>
        <div class="small">Tools और stats localStorage में रहते हैं।</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="addTool" class="big-btn">+ Add Demo Tool</button>
          <button id="resetTools" class="danger">Reset Tools</button>
        </div>
        <div style="margin-top:10px" class="small">Tools list</div>
        <div class="tools-list" id="toolsList"></div>

        <hr style="margin:10px 0;border-color:rgba(255,255,255,0.03)">
        <strong>Import / Export</strong>
        <div class="small">Paste exported JSON and Apply</div>
        <textarea id="importBox" rows="4" placeholder="Paste exported JSON here"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="applyImport">Apply Import</button>
          <button id="exportAll">Export All</button>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="resetAllStats">Reset all stats</button>
          <button id="openDashboard">Open Dashboard</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <strong>Owner links</strong>
        <div id="ownerLinksRender">—</div>
        <div style="margin-top:8px" class="hint">© Omniverse Marketplace — localStorage only · Deploy: GitHub Pages</div>
        <div class="hint">For paid integrations add links in Owner Settings</div>
      </div>
    </div>

    <!-- RIGHT COLUMN: Tool editor / runner -->
    <div class="right-col">
      <div class="card toolbar">
        <div>
          <select id="toolSelect">
            <option value="">— Select a tool —</option>
          </select>
          <div class="hint">Tools are local. Generate outputs, download, tip owner.</div>
        </div>
        <div class="flex">
          <div class="stat-badge" id="selectedUses">Selected Uses: 0</div>
          <div class="stat-badge" id="selectedDownloads">Selected Downloads: 0</div>
        </div>
      </div>

      <div class="card editor">
        <div>
          <div style="margin-bottom:8px;color:var(--muted)">Tool description</div>
          <div id="toolDesc" style="min-height:56px;background:transparent;padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03)"></div>

          <label style="margin-top:12px">Tip: structured JSON input देने से output बेहतर होगा।</label>
          <textarea id="toolInput" rows="6" placeholder='Enter JSON input for the selected tool e.g. {"name":"Your Name","field":"AI"}'>{"name":"Your Name","field":"AI"}</textarea>

          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="generateBtn" class="big-btn">Generate</button>
            <button id="clearBtn">Clear</button>
            <button id="copyBtn">Copy</button>
            <button id="downloadBtn">⬇️ Download</button>
            <button id="resetToolStats">Reset Tool Stats</button>
          </div>

          <div style="margin-top:12px">
            <div class="hint">AI output (demo — client-side)</div>
            <pre id="outputArea" style="min-height:160px">Generated output will appear here.</pre>
          </div>
        </div>

        <div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Tool Editor</strong>
            <div class="hint">Saved tools are local to your browser.</div>
          </div>

          <label>Tool Name</label>
          <input id="editName" placeholder="Tool name" />
          <label>Template (use {{key}} placeholders)</label>
          <textarea id="editTemplate" rows="6" placeholder="Hello {{name}}, welcome to {{field}}">Hello {{name}}, welcome to {{field}}</textarea>
          <label>Tool description (short)</label>
          <input id="editDesc" placeholder="Short description" />
          <label>Example input (JSON)</label>
          <textarea id="editExample" rows="3">{"name":"Your Name","field":"AI"}</textarea>

          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="saveTool">Save Tool</button>
            <button id="deleteTool" class="danger">Delete</button>
          </div>

          <div style="margin-top:12px" class="hint">Tip: use simple keys like {{name}} in templates and pass JSON input. The generator replaces unknown keys with empty string.</div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="small">Developed for Omniverse — Local demo. Replace with real AI / payments when ready.</div>
  </footer>

  <script>
    // Namespaced localStorage keys
    const LS_TOOLS = 'omniverse_tools_v1';
    const LS_OWNER = 'omniverse_owner_v1';
    const LS_STATS = 'omniverse_stats_v1';

    // Utilities
    function qs(id){ return document.getElementById(id); }
    function saveJSON(key, obj){ localStorage.setItem(key, JSON.stringify(obj)); }
    function loadJSON(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) || fallback; }catch{ return fallback; } }

    // Initial state load
    let tools = loadJSON(LS_TOOLS, []);
    let owner = loadJSON(LS_OWNER, {name:'', links:[]});
    let stats = loadJSON(LS_STATS, {uses:0, downloads:0, toolStats:{}});

    // DOM refs
    const toolsList = qs('toolsList');
    const toolSelect = qs('toolSelect');
    const addToolBtn = qs('addTool');
    const resetToolsBtn = qs('resetTools');
    const saveOwnerBtn = qs('saveOwner');
    const ownerNameInput = qs('ownerName');
    const ownerLinksInput = qs('ownerLinks');
    const ownerLinksRender = qs('ownerLinksRender');
    const usesBadge = qs('usesBadge'), dlBadge = qs('dlBadge');
    const selectedUses = qs('selectedUses'), selectedDownloads = qs('selectedDownloads');

    const toolDesc = qs('toolDesc'), toolInput = qs('toolInput'), generateBtn = qs('generateBtn');
    const outputArea = qs('outputArea'), copyBtn = qs('copyBtn'), downloadBtn = qs('downloadBtn'), clearBtn = qs('clearBtn');
    const editName = qs('editName'), editTemplate = qs('editTemplate'), editDesc = qs('editDesc'), editExample = qs('editExample');
    const saveToolBtn = qs('saveTool'), deleteToolBtn = qs('deleteTool');

    const applyImport = qs('applyImport'), importBox = qs('importBox'), exportAllBtn = qs('exportAll'), resetAllStatsBtn = qs('resetAllStats');
    const exportOwnerBtn = qs('exportOwner'), importOwnerBtn = qs('importOwner'), openDashboard = qs('openDashboard');

    // Helpers: render owner
    function renderOwner(){
      ownerNameInput.value = owner.name || '';
      ownerLinksInput.value = (owner.links || []).join(', ');
      if((owner.links||[]).length){
        ownerLinksRender.innerHTML = (owner.links||[]).map(l => `<div><a href="${escapeHtml(l)}" target="_blank" rel="noreferrer">${escapeHtml(l)}</a></div>`).join('');
      } else ownerLinksRender.innerHTML = '—';
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Helpers: save/load
    function persistAll(){ saveJSON(LS_TOOLS, tools); saveJSON(LS_OWNER, owner); saveJSON(LS_STATS, stats); }

    // Tools UI
    function renderToolsList(){
      toolsList.innerHTML = '';
      toolSelect.innerHTML = '<option value="">— Select a tool —</option>';
      tools.forEach((t, idx) => {
        const el = document.createElement('div'); el.className='tool-row';
        el.innerHTML = `<div style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>${escapeHtml(t.name)}</strong><div class="meta">${escapeHtml(t.description||'')}</div></div>
            <div style="display:flex;gap:6px">
              <button data-idx="${idx}" class="selectBtn">Open</button>
              <button data-idx="${idx}" class="dupBtn">Duplicate</button>
            </div>
          </div>
        </div>`;
        toolsList.appendChild(el);

        const opt = document.createElement('option'); opt.value = String(idx); opt.textContent = t.name; toolSelect.appendChild(opt);
      });
      // attach events
      Array.from(document.querySelectorAll('.selectBtn')).forEach(b => b.addEventListener('click', e => {
        const idx = Number(e.currentTarget.dataset.idx); selectTool(idx);
      }));
      Array.from(document.querySelectorAll('.dupBtn')).forEach(b => b.addEventListener('click', e => {
        const idx = Number(e.currentTarget.dataset.idx); duplicateTool(idx);
      }));
      refreshBadges();
    }

    function refreshBadges(){
      usesBadge.textContent = 'Uses: ' + (stats.uses||0);
      dlBadge.textContent = 'Downloads: ' + (stats.downloads||0);
      // selected badges updated elsewhere
    }

    // Create a default demo tool if none exist
    function ensureDemo(){
      if(!tools.length){
        tools.push({
          id: Date.now(),
          name: 'Hello Generator',
          template: 'Hello {{name}}, welcome to {{field}}.',
          description: 'Simple greeting generator. Use JSON input with keys name and field.',
          example: JSON.stringify({name:'Your Name', field:'AI'})
        });
        persistAll();
      }
    }

    function addNewTool(){
      const t = {
        id: Date.now(),
        name: 'New Tool',
        template: 'Hello {{name}}',
        description: 'Describe this tool',
        example: '{"name":"Your Name"}'
      };
      tools.push(t); persistAll(); renderToolsList(); selectTool(tools.length-1);
    }

    function duplicateTool(idx){
      const copy = JSON.parse(JSON.stringify(tools[idx])); copy.id = Date.now(); copy.name = copy.name + ' (copy)';
      tools.push(copy); persistAll(); renderToolsList();
    }

    function resetTools(){
      if(!confirm('Confirm: remove all saved tools?')) return;
      tools = []; stats = {uses:0,downloads:0,toolStats:{}}; persistAll(); ensureDemo(); renderToolsList(); selectTool(0);
    }

    // Select tool and populate editor
    let selectedIndex = null;
    function selectTool(idx){
      if(typeof idx !== 'number' || !tools[idx]){ selectedIndex = null; qs('toolSelect').value = ''; clearEditor(); return; }
      selectedIndex = idx;
      qs('toolSelect').value = String(idx);
      const t = tools[idx];
      editName.value = t.name; editTemplate.value = t.template; editDesc.value = t.description || ''; editExample.value = t.example || '{}';
      toolDesc.textContent = t.description || '';
      // tool input default to example
      try{ toolInput.value = JSON.stringify(JSON.parse(t.example||'{}'),null,0); }catch{ toolInput.value = t.example || '{}' }
      updateSelectedStats();
    }

    function updateSelectedStats(){
      if(selectedIndex === null){ selectedUses.textContent = 'Selected Uses: 0'; selectedDownloads.textContent = 'Selected Downloads: 0'; return; }
      const t = tools[selectedIndex]; const id = t.id;
      const s = stats.toolStats && stats.toolStats[id] ? stats.toolStats[id] : {uses:0,downloads:0};
      selectedUses.textContent = 'Selected Uses: ' + (s.uses||0);
      selectedDownloads.textContent = 'Selected Downloads: ' + (s.downloads||0);
    }

    function clearEditor(){
      editName.value = ''; editTemplate.value=''; editDesc.value=''; editExample.value='{}'; toolDesc.textContent = ''; toolInput.value='{}';
      outputArea.textContent = 'Generated output will appear here.';
    }

    // Save / delete tool
    function saveTool(){
      if(selectedIndex === null){ alert('No tool selected. Use Add Tool to create.'); return; }
      const t = tools[selectedIndex];
      t.name = editName.value || 'Untitled';
      t.template = editTemplate.value || '';
      t.description = editDesc.value || '';
      t.example = editExample.value || '';
      persistAll(); renderToolsList(); selectTool(selectedIndex);
      alert('Saved.');
    }

    function deleteTool(){
      if(selectedIndex === null) return alert('No tool selected.');
      if(!confirm('Delete this tool?')) return;
      tools.splice(selectedIndex,1); persistAll(); renderToolsList();
      selectedIndex = null; clearEditor();
    }

    // Generate output (simple template substitution)
    function generateOutput(){
      if(selectedIndex === null) return alert('Select a tool first.');
      const t = tools[selectedIndex];
      let inputObj = {};
      try{
        const raw = toolInput.value.trim() || '{}';
        inputObj = JSON.parse(raw);
      } catch(e){ return alert('Invalid JSON input: ' + e.message); }
      // Replacement: find all {{key}} and replace
      let out = t.template || '';
      out = out.replace(/{{\s*([a-zA-Z0-9_$.]+)\s*}}/g, (m,k)=>{
        // support nested props like a.b
        try{
          const keys = k.split('.');
          let v = inputObj;
          for(const key of keys){
            if(v == null) return '';
            v = v[key];
          }
          return v == null ? '' : String(v);
        }catch{ return '' }
      });
      // small enhancement: if template contains {{__json__}} replace with stringified input
      out = out.replace(/{{\s*__json__\s*}}/g, JSON.stringify(inputObj, null, 2));
      outputArea.textContent = out;
      // update stats
      stats.uses = (stats.uses||0) + 1;
      stats.toolStats = stats.toolStats || {};
      stats.toolStats[t.id] = stats.toolStats[t.id] || {uses:0,downloads:0};
      stats.toolStats[t.id].uses += 1;
      persistAll(); refreshBadges(); updateSelectedStats();
    }

    // Download output
    function downloadOutput(){
      if(selectedIndex === null) return alert('Select a tool first.');
      const t = tools[selectedIndex];
      const out = outputArea.textContent || '';
      const filename = (t.name||'output').replace(/\s+/g,'-').toLowerCase() + '.txt';
      const blob = new Blob([out], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      // stats
      stats.downloads = (stats.downloads||0) + 1;
      stats.toolStats = stats.toolStats || {};
      stats.toolStats[t.id] = stats.toolStats[t.id] || {uses:0,downloads:0};
      stats.toolStats[t.id].downloads += 1;
      persistAll(); refreshBadges(); updateSelectedStats();
    }

    // Copy output to clipboard
    async function copyOutput(){
      try{ await navigator.clipboard.writeText(outputArea.textContent || ''); alert('Copied to clipboard'); }
      catch(e){ alert('Copy failed: ' + e.message); }
    }

    // Reset tool stats
    function resetToolStats(){
      if(selectedIndex === null) return;
      const t = tools[selectedIndex];
      if(!confirm('Reset stats for this tool?')) return;
      if(stats.toolStats && stats.toolStats[t.id]) stats.toolStats[t.id] = {uses:0,downloads:0};
      persistAll(); updateSelectedStats(); refreshBadges();
    }

    // Export / import tools
    function exportAll(){
      const payload = {tools, owner, stats, exportedAt: new Date().toISOString()};
      const s = JSON.stringify(payload,null,2);
      const blob = new Blob([s], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'omniverse-marketplace-export.json'; document.body.appendChild(a); a.click(); a.remove();
    }

    function applyImportData(){
      try{
        const obj = JSON.parse(importBox.value);
        if(Array.isArray(obj.tools)) tools = obj.tools;
        if(obj.owner) owner = obj.owner;
        if(obj.stats) stats = obj.stats;
        persistAll(); renderToolsList(); renderOwner(); alert('Import applied.');
      }catch(e){ alert('Import failed: ' + e.message); }
    }

    // Owner save / export / import
    function saveOwner(){
      owner.name = ownerNameInput.value.trim();
      owner.links = ownerLinksInput.value.split(',').map(s=>s.trim()).filter(Boolean);
      persistAll(); renderOwner(); alert('Owner saved locally.');
    }
    function exportOwner(){
      const s = JSON.stringify(owner,null,2);
      const blob = new Blob([s], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL
