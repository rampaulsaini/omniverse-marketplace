<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Omniverse Marketplace ‚Äî AI & Tips (fixed sidebar)</title>
<link rel="icon" href="assets/favicon.ico">
<style>
  :root{
    --bg:#0b1220; --card:#081425; --muted:#9fb0d9; --accent:#4fa3ff;
  }
  html,body{height:100%;margin:0;padding:0;background:var(--bg);color:#e6eef8;font-family:Inter,Arial,system-ui}
  header{height:56px;background:#081425;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,0.03)}
  header h1{margin:0;font-size:16px}
  .container{display:flex;height:calc(100vh - 56px);overflow:hidden}
  /* SIDEBAR */
  .sidebar{width:300px;min-width:220px;background:linear-gradient(180deg,#061427,#081a30);padding:12px;border-right:1px solid rgba(255,255,255,0.03);box-sizing:border-box;overflow:auto}
  .sidebar .search{margin-bottom:8px}
  .sidebar input.searchbox{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);color:inherit}
  .tool-btn{display:block;width:100%;text-align:left;padding:8px;border-radius:8px;border:0;background:transparent;color:inherit;margin-bottom:6px;cursor:pointer;font-size:13px;}
  .tool-btn:hover{background:rgba(255,255,255,0.02)}
  .tool-btn.active{background:rgba(79,163,255,0.12);box-shadow:inset 0 0 0 1px rgba(79,163,255,0.06)}
  /* MAIN */
  .main{flex:1;padding:16px;box-sizing:border-box;overflow:auto}
  .controls{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
  button.action{background:#10253a;color:#e6eef8;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  textarea#tool-output{width:100%;height:48vh;padding:12px;border-radius:8px;background:#071527;border:1px solid rgba(255,255,255,0.03);color:inherit;resize:vertical;font-family:monospace}
  .tips{margin-top:10px;font-size:14px}
  .muted{color:var(--muted);font-size:13px}
  /* small screens */
  @media (max-width:800px){
    .sidebar{width:46%;min-width:200px}
    .main{padding:10px}
  }
</style>
</head>
<body>
  <header>
    <h1>Omniverse Marketplace ‚Äî AI & Tips</h1>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="action" onclick="openSettings()">Owner Settings</button>
      <span class="muted" id="owner-name-badge"></span>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar" id="sidebar">
      <div class="search">
        <input class="searchbox" id="tool-search" placeholder="Search tools (type name)..." />
      </div>
      <div id="tool-list" aria-live="polite"></div>
    </aside>

    <main class="main">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h2 id="tool-title">‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§æ‡§è‡§Å ‡§∏‡•á ‡§è‡§ï tool ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</h2>
        <div class="muted">Tools: <span id="tool-count">0</span></div>
      </div>

      <div class="controls">
        <button class="action" onclick="runTool()">Run</button>
        <button class="action" onclick="downloadOutput()">Download</button>
        <button class="action" onclick="copyOutput()">Copy</button>
        <button class="action" onclick="cloneTool()">Clone Tool</button>
      </div>

      <textarea id="tool-output" placeholder="Output will appear here..."></textarea>
      <div class="tips" id="tips-links"></div>
      <div class="muted" style="margin-top:12px">Tip: ‡§Ö‡§ó‡§∞ tools ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ‡§§‡•á ‡§§‡•ã DevTools (F12) ‡§ñ‡•ã‡§≤‡§ï‡§∞ Console ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à error ‡§§‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§ñ ‡§∞‡§π‡§æ ‚Äî ‡§µ‡•ã screenshot ‡§≠‡•á‡§ú‡§ø‡§è ‡§Æ‡•à‡§Ç ‡§§‡•Å‡§∞‡§®‡•ç‡§§ ‡§¶‡•á‡§ñ ‡§≤‡•Ç‡§Å‡§ó‡§æ‡•§</div>
    </main>
  </div>

  <!-- Owner Settings modal (simple) -->
  <div id="owner-modal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:999">
    <div style="background:#071827;padding:16px;border-radius:10px;max-width:480px;width:92%;box-shadow:0 10px 30px rgba(0,0,0,0.6)">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong style="font-size:16px">Owner Settings</strong>
        <button onclick="closeSettings()" style="background:transparent;border:0;color:#e6eef8;font-size:20px;cursor:pointer">&times;</button>
      </div>

      <div style="margin-bottom:8px"><label class="muted">Owner name</label><input id="owner-name" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ"></div>
      <div style="margin-bottom:8px"><label class="muted">Pay / Donate links (comma separated)</label><textarea id="owner-links" rows="2" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" placeholder="upi:abc@paytm, https://paypal.me/you"></textarea></div>
      <div style="margin-bottom:8px"><label class="muted">OpenAI API key (optional)</label><input id="omniverse-openai-key" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" placeholder="sk-..."></div>

      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="action" onclick="saveOpenAIKey()">Save API Key</button>
        <button class="action" onclick="saveOwnerSettings()">Save</button>
      </div>
    </div>
  </div>

<script>
/* ===========
   Robust script: render tools after DOM is ready, ensure buttons block-level,
   provide search, debug logging.
   =========== */

document.addEventListener('DOMContentLoaded', () => {
  try{
    console.log('Omniverse: DOMContentLoaded ‚Äî initializing tools UI');
    initApp(); // main init
  }catch(err){
    console.error('Initialization error:', err);
    alert('Error initializing page ‚Äî open console (F12) and share the error.');
  }
});

function initApp(){
  // STORAGE KEY
  const LS_KEY = 'omniverse_tools_v1';
  let tools = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

  // ensure at least 100 tools exist
  if(!Array.isArray(tools) || tools.length < 100){
    tools = [];
    for(let i=1;i<=100;i++){
      tools.push({ name: `Tool ${i}`, generatorPrompt: `Generate content for Tool ${i}` });
    }
    localStorage.setItem(LS_KEY, JSON.stringify(tools));
    console.log('Initialized default 100 tools');
  }

  // expose tools to window for debugging
  window._omniverse_tools = tools;

  // state
  let selectedIndex = null;

  // DOM refs
  const toolListEl = document.getElementById('tool-list');
  const toolTitleEl = document.getElementById('tool-title');
  const toolOutputEl = document.getElementById('tool-output');
  const toolCountEl = document.getElementById('tool-count');
  const ownerNameBadge = document.getElementById('owner-name-badge');
  const searchBox = document.getElementById('tool-search');

  // render helpers
  function renderToolList(filter){
    toolListEl.innerHTML = '';
    const fragment = document.createDocumentFragment();
    tools.forEach((t,i) => {
      if(filter && !t.name.toLowerCase().includes(filter.toLowerCase())) return;
      const btn = document.createElement('button');
      btn.className = 'tool-btn';
      btn.textContent = t.name;
      btn.type = 'button';
      btn.id = 'tool-btn-' + i;
      btn.onclick = () => selectTool(i);
      fragment.appendChild(btn);
    });
    toolListEl.appendChild(fragment);
    toolCountEl.textContent = tools.length;
    console.log('Rendered', tools.length, 'tools (filter=', filter||'none',')');
  }

  function updateOwnerBadge(){
    const name = localStorage.getItem('omniverse_owner_name') || '';
    ownerNameBadge.textContent = name ? `Owner: ${name}` : '';
  }

  // selection
  function selectTool(i){
    selectedIndex = i;
    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
    const btn = document.getElementById('tool-btn-'+i);
    if(btn) btn.classList.add('active');
    const t = tools[i];
    toolTitleEl.textContent = t.name;
    toolOutputEl.value = ''; // clear previous
    renderTips();
  }

  // search
  searchBox.addEventListener('input', (e) => {
    renderToolList(e.target.value.trim());
  });

  // render tips / links
  function renderTips(){
    const div = document.getElementById('tips-links');
    const links = JSON.parse(localStorage.getItem('omniverse_owner_links')||'[]');
    div.innerHTML = '';
    if(links.length){
      const label = document.createElement('div'); label.textContent='Support Owner:';
      div.appendChild(label);
      links.forEach(l => {
        const a = document.createElement('a');
        a.href = l; a.target = '_blank';
        a.textContent = ' üí∞ Tip ';
        a.style.marginRight = '8px';
        div.appendChild(a);
      });
    }
  }

  // actions
  async function runTool(){
    if(selectedIndex===null){ alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï tool ‡§ö‡•Å‡§®‡•á‡§Ç‡•§'); return; }
    const t = tools[selectedIndex];
    toolOutputEl.value = 'Generating AI output...';
    const prompt = t.generatorPrompt || `Generate content for ${t.name}`;

    // try to call OpenAI if key present
    const apiKey = localStorage.getItem('omniverse_openai_key');
    if(!apiKey){
      // fallback: simple placeholder (non-AI)
      toolOutputEl.value = `Placeholder output for ${t.name}\n\nPrompt: ${prompt}\n\n(Provide OpenAI API key in Owner Settings to get AI output)`;
      return;
    }

    try{
      const res = await fetch('https://api.openai.com/v1/completions', {
        method: 'POST',
        headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${apiKey}` },
        body: JSON.stringify({ model:'text-davinci-003', prompt: prompt, max_tokens:250 })
      });
      if(!res.ok){
        const txt = await res.text();
        toolOutputEl.value = `API Error: ${res.status} ${res.statusText}\n${txt}`;
        console.error('OpenAI error:', res.status, res.statusText, txt);
        return;
      }
      const data = await res.json();
      toolOutputEl.value = (data.choices && data.choices[0] && data.choices[0].text) ? data.choices[0].text.trim() : JSON.stringify(data,null,2);
    }catch(err){
      console.error('Run error', err);
      toolOutputEl.value = 'Error generating AI output: ' + (err.message || err);
    }
  }

  function downloadOutput(){
    const val = toolOutputEl.value;
    if(!val){ alert('No output to download'); return; }
    const fileName = (selectedIndex!==null ? tools[selectedIndex].name : 'output') + '.txt';
    const blob = new Blob([val], { type:'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = fileName; a.click();
    URL.revokeObjectURL(url);
  }

  function copyOutput(){
    const val = toolOutputEl.value;
    if(!val){ alert('No output to copy'); return; }
    navigator.clipboard.writeText(val).then(()=> alert('Output copied to clipboard'));
  }

  function cloneTool(){
    if(selectedIndex===null){ alert('Select a tool to clone'); return; }
    const orig = tools[selectedIndex];
    const name = prompt('Name for cloned tool', orig.name + ' Copy');
    if(!name) return;
    tools.push({ name: name, generatorPrompt: orig.generatorPrompt });
    saveTools();
    renderToolList();
  }

  function saveTools(){
    localStorage.setItem(LS_KEY, JSON.stringify(tools));
  }

  // owner settings methods (modal)
  function openSettings(){ document.getElementById('owner-modal').style.display='flex'; document.getElementById('owner-name').value = localStorage.getItem('omniverse_owner_name')||''; document.getElementById('owner-links').value = localStorage.getItem('omniverse_owner_links_raw')||''; document.getElementById('omniverse-openai-key').value = localStorage.getItem('omniverse_openai_key')||''; }
  function closeSettings(){ document.getElementById('owner-modal').style.display='none'; }
  function saveOpenAIKey(){ const k = document.getElementById('omniverse-openai-key').value.trim(); localStorage.setItem('omniverse_openai_key', k); alert('API key saved locally'); }
  function saveOwnerSettingsLocal(){ const name = document.getElementById('owner-name').value.trim(); const linksText = document.getElementById('owner-links').value; const links = linksText.split(',').map(s=>s.trim()).filter(Boolean); localStorage.setItem('omniverse_owner_name', name); localStorage.setItem('omniverse_owner_links', JSON.stringify(links)); localStorage.setItem('omniverse_owner_links_raw', linksText); alert('Owner settings saved'); updateOwnerBadge(); renderTips(); }

  // wire up global helpers for buttons
  window.openSettings = openSettings;
  window.closeSettings = closeSettings;
  window.saveOpenAIKey = saveOpenAIKey;
  window.saveOwnerSettings = saveOwnerSettingsLocal;
  window.runTool = runTool;
  window.downloadOutput = downloadOutput;
  window.copyOutput = copyOutput;
  window.cloneTool = cloneTool;
  window.addTool = function(){ const name = prompt('New tool name'); if(!name) return; tools.push({name:name, generatorPrompt:`Generate content for ${name}`}); saveTools(); renderToolList(); };
  window.resetTools = function(){ if(confirm('Reset all tools?')){ tools = []; saveTools(); renderToolList(); toolOutputEl.value=''; }};

  // initial render
  renderToolList();
  updateOwnerBadge();
  renderTips();

  console.log('Omniverse UI initialized ‚Äî tools available:', tools.length);

  // expose for debugging
  window._omniverse = { tools, renderToolList, runTool };
}
</script>
</body>
                                                    </html>
  
