<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Omniverse Marketplace — Local Demo</title>
  <style>
    :root{
      --bg:#07142a; --card:#08172f; --muted:#9fb0d6; --accent:#60a5fa;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#041022 0%, #061428 100%);color:#e6eef8;min-height:100vh}
    .wrap{max-width:1100px;margin:18px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    h1{font-size:18px;margin:0}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:14px}
    .card{background:linear-gradient(180deg,var(--card), rgba(0,0,0,0.02));border:1px solid var(--glass);padding:12px;border-radius:10px}
    label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
    input[type="text"], textarea, select {width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px}
    .tools-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .tool-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px dashed rgba(255,255,255,0.02);background:linear-gradient(180deg,transparent, rgba(255,255,255,0.01))}
    .btn-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .flex{display:flex;gap:8px;align-items:center}
    textarea{min-height:80px;resize:vertical}
    .preview-box{background:#021426;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);min-height:140px;white-space:pre-wrap}
    footer{margin-top:12px;color:var(--muted);font-size:13px}
    .badge{background:rgba(255,255,255,0.02);padding:4px 8px;border-radius:999px;font-size:12px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .full{grid-column:1/-1}
    .danger{border-color:#ff6b6b;color:#ffb4b4}
    .ok{border-color:#2dd4bf;color:#bbfff0}
    .hidden{display:none}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Omniverse Marketplace — Local Demo</h1>
        <div class="muted">Zero-cost · Donation-ready · Settings & stats local to your browser</div>
      </div>
      <div style="margin-left:auto" class="flex">
        <div class="badge" id="ownerBadge">Owner: —</div>
        <div class="badge" id="toolsBadge">Tools: 0</div>
        <div class="badge" id="usesBadge">Uses: 0</div>
        <div class="badge" id="downloadsBadge">Downloads: 0</div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Owner / Controls -->
      <div>
        <div class="card">
          <strong>Owner Settings (Local)</strong>
          <div class="muted small">Owner settings केवल आपके ब्राउज़र में सेव होते हैं।</div>

          <label>Owner name</label>
          <input id="ownerName" placeholder="आपका नाम (Owner)">

          <label>Donate / Pay links (comma separated)</label>
          <input id="ownerLinks" placeholder="upi:abc@bank, https://paypal.me/you, https://ko-fi.com/you">

          <div class="btn-row">
            <button id="saveOwner">Save Settings</button>
            <button id="exportOwner">Export</button>
            <button id="importOwner">Import</button>
            <button id="resetOwner" class="danger">Reset</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Marketplace Controls</strong>
          <div class="muted small">Tools और stats localStorage में रहते हैं।</div>
          <div style="margin-top:8px">
            <div class="small">Owner: <span id="ownerNameDisplay">—</span></div>
            <div class="small">Tools: <span id="toolsCount">0</span></div>
            <div class="small">Downloads: <span id="totalDownloads">0</span></div>
            <div class="small">Uses: <span id="totalUses">0</span></div>
          </div>

          <div class="btn-row" style="margin-top:10px">
            <button id="addTool">+ Add Demo Tool</button>
            <button id="resetTools" class="danger">Reset Tools</button>
            <button id="openDashboard">Open Dashboard</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Tools list</strong>
          <div class="muted small">Import / Export: Paste exported JSON and Apply</div>

          <div style="margin-top:8px" class="cols">
            <textarea id="importArea" placeholder="Paste exported JSON here"></textarea>
            <div>
              <div style="display:flex;flex-direction:column;gap:8px">
                <button id="applyImport">Apply Import</button>
                <button id="exportAll">Export All</button>
                <button id="resetAllStats" class="danger">Reset all stats</button>
              </div>
            </div>
          </div>

          <div class="tools-list" id="toolsList" style="margin-top:10px">
            <!-- populated -->
          </div>
        </div>
      </div>

      <!-- RIGHT: Tool area -->
      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong id="selectedToolName">— Select a tool —</strong>
              <div class="muted small">Tools are local. Generate outputs, download, tip owner.</div>
            </div>
            <div class="muted small">Selected Uses: <span id="selUses">0</span> • Downloads: <span id="selDownloads">0</span></div>
          </div>

          <div style="margin-top:10px">
            <div class="muted">Tool description</div>
            <div id="selectedToolDesc" class="muted small" style="margin-top:6px">Tool description will appear here.</div>
          </div>

          <label style="margin-top:10px">Tip: structured JSON input देने से output बेहतर होगा।</label>
          <textarea id="jsonInput" placeholder='Enter JSON input for the selected tool e.g. {"name":"Your Name","field":"AI"}'></textarea>

          <div class="btn-row" style="margin-top:10px">
            <button id="generateBtn">Generate</button>
            <button id="clearOutput">Clear</button>
            <button id="copyOutput">Copy</button>
            <button id="downloadOutput">⬇️ Download</button>
            <div style="margin-left:auto" class="flex">
              <button id="resetToolStats" class="danger">Reset Tool Stats</button>
              <button id="exportTool">Export Tool</button>
            </div>
          </div>

          <div style="margin-top:10px">
            <div class="preview-box" id="outputArea">AI output (demo — client-side)
No external APIs called. Owner can export/import settings.</div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Tool Editor</strong>
          <div class="muted small">Edit selected tool (saved locally)</div>

          <label>Tool Name</label>
          <input id="toolName" placeholder="Tool name">

          <label>Template (use {{key}} placeholders)</label>
          <textarea id="toolTemplate" placeholder="Hello {{name}}, welcome to {{field}}"></textarea>

          <label>Tool description (short)</label>
          <input id="toolDesc" placeholder="Short description">

          <div class="btn-row" style="margin-top:8px">
            <button id="saveTool">Save Tool</button>
            <button id="deleteTool" class="danger">Delete</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Owner links</strong>
          <div class="muted small" id="ownerLinksList">—</div>
        </div>
      </div>
    </div>

    <footer>
      © Omniverse Marketplace — localStorage only · Deploy: GitHub Pages<br>
      For paid integrations add links in Owner Settings
    </footer>
  </div>

  <script>
    // Single-file local storage Omniverse Marketplace
    (function(){
      const LS_KEYS = {
        OWNER: 'omni_owner_v1',
        TOOLS: 'omni_tools_v1',
        STATS: 'omni_stats_v1' // aggregate
      };

      // Utilities
      const $ = (id)=>document.getElementById(id);
      const q = (sel, ctx=document)=>ctx.querySelector(sel);
      const notify = (t)=>{ console.log('[omni]', t); };

      // State
      let tools = {}; // {id: {id,name,template,desc}}
      let stats = { totalUses:0, totalDownloads:0, perTool: {} };
      let owner = { name:'', links: '' };
      let selectedToolId = null;

      // DOM refs
      const ownerName = $('ownerName'), ownerLinks = $('ownerLinks'), saveOwnerBtn = $('saveOwner');
      const exportOwnerBtn = $('exportOwner'), importOwnerBtn = $('importOwner'), resetOwnerBtn = $('resetOwner');
      const ownerBadge = $('ownerBadge'), ownerNameDisplay = $('ownerNameDisplay'), ownerLinksList = $('ownerLinksList');

      const toolsListEl = $('toolsList'), addToolBtn = $('addTool'), resetToolsBtn = $('resetTools'), openDashboardBtn = $('openDashboard');
      const importArea = $('importArea'), applyImportBtn = $('applyImport'), exportAllBtn = $('exportAll');
      const resetAllStatsBtn = $('resetAllStats');

      const selectedToolName = $('selectedToolName'), selectedToolDesc = $('selectedToolDesc');
      const jsonInput = $('jsonInput'), generateBtn = $('generateBtn'), clearOutput = $('clearOutput'), copyOutput = $('copyOutput'), downloadOutput = $('downloadOutput');
      const outputArea = $('outputArea'), selUses = $('selUses'), selDownloads = $('selDownloads');

      const toolNameIn = $('toolName'), toolTemplateIn = $('toolTemplate'), toolDescIn = $('toolDesc');
      const saveToolBtn = $('saveTool'), deleteToolBtn = $('deleteTool');
      const toolsBadge = $('toolsBadge'), toolsCount = $('toolsCount');
      const totalDownloadsEl = $('totalDownloads'), totalUsesEl = $('totalUses'), usesBadge = $('usesBadge'), downloadsBadge = $('downloadsBadge');
      const ownerBadgeEl = ownerBadge;

      const resetToolStatsBtn = $('resetToolStats'), exportToolBtn = $('exportTool');

      // helpers
      function uid(prefix='t'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
      function loadState(){
        try{ owner = JSON.parse(localStorage.getItem(LS_KEYS.OWNER)) || {name:'', links:''}; }catch(e){owner={name:'',links:''}}
        try{ tools = JSON.parse(localStorage.getItem(LS_KEYS.TOOLS)) || {}; }catch(e){tools={}}
        try{ stats = JSON.parse(localStorage.getItem(LS_KEYS.STATS)) || { totalUses:0, totalDownloads:0, perTool: {} }; }catch(e){stats={ totalUses:0, totalDownloads:0, perTool:{} }}
      }
      function saveAll(){
        localStorage.setItem(LS_KEYS.OWNER, JSON.stringify(owner));
        localStorage.setItem(LS_KEYS.TOOLS, JSON.stringify(tools));
        localStorage.setItem(LS_KEYS.STATS, JSON.stringify(stats));
        renderAll();
      }

      function renderOwner(){
        ownerBadge.textContent = 'Owner: ' + (owner.name || '—');
        ownerNameDisplay.textContent = owner.name || '—';
        ownerName.value = owner.name || '';
        ownerLinks.value = owner.links || '';
        ownerLinksList.innerHTML = owner.links ? owner.links.split(',').map(s=>s.trim()).filter(Boolean).map(s=> {
          const a = s.startsWith('http') || s.startsWith('upi:') ? s : s;
          return `<div><a href="${s.startsWith('http')?s:'#'}" target="_blank" style="color:var(--accent)">${a}</a></div>`;
        }).join('') : '—';
      }

      function aggregateStats(){
        const tcount = Object.keys(tools).length;
        toolsBadge.textContent = 'Tools: ' + tcount;
        toolsCount.textContent = tcount;
        totalDownloadsEl.textContent = stats.totalDownloads || 0;
        totalUsesEl.textContent = stats.totalUses || 0;
        usesBadge.textContent = 'Uses: ' + (stats.totalUses || 0);
        downloadsBadge.textContent = 'Downloads: ' + (stats.totalDownloads || 0);
        toolsCount.textContent = tcount;
      }

      function renderToolsList(){
        toolsListEl.innerHTML = '';
        const ids = Object.keys(tools);
        if(!ids.length){
          const el = document.createElement('div');
          el.className = 'muted small';
          el.textContent = '— कोई tools नहीं —';
          toolsListEl.appendChild(el);
          return;
        }
        ids.forEach(id=>{
          const t = tools[id];
          const item = document.createElement('div');
          item.className = 'tool-item';
          item.innerHTML = `
            <div>
              <div style="font-weight:600">${escapeHtml(t.name)}</div>
              <div class="muted small">${escapeHtml(t.desc || '')}</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <div class="muted small" style="min-width:80px;text-align:right">Uses: ${stats.perTool[id]?.uses||0} • Dls: ${stats.perTool[id]?.downloads||0}</div>
              <button data-id="${id}" class="selectBtn">Open</button>
            </div>
          `;
          toolsListEl.appendChild(item);
        });

        // attach select handlers
        toolsListEl.querySelectorAll('.selectBtn').forEach(b=>{
          b.addEventListener('click', (e)=>{
            const id = e.currentTarget.getAttribute('data-id');
            selectTool(id);
          });
        });
      }

      function selectTool(id){
        if(!id || !tools[id]) { selectedToolId = null; clearSelection(); return; }
        selectedToolId = id;
        const t = tools[id];
        selectedToolName.textContent = t.name;
        selectedToolDesc.textContent = t.desc || '—';
        toolNameIn.value = t.name;
        toolTemplateIn.value = t.template;
        toolDescIn.value = t.desc || '';
        const ps = stats.perTool[id] || {uses:0, downloads:0};
        selUses.textContent = ps.uses || 0;
        selDownloads.textContent = ps.downloads || 0;
      }

      function clearSelection(){
        selectedToolName.textContent = '— Select a tool —';
        selectedToolDesc.textContent = 'Tool description will appear here.';
        toolNameIn.value = '';
        toolTemplateIn.value = '';
        toolDescIn.value = '';
        selUses.textContent = 0;
        selDownloads.textContent = 0;
        jsonInput.value = '';
        outputArea.textContent = 'AI output (demo — client-side)\nNo external APIs called. Owner can export/import settings.';
      }

      // template renderer: replaces {{key}} with value; supports nested keys via dot notation.
      function renderTemplate(tpl, data){
        if(typeof tpl !== 'string') return '';
        return tpl.replace(/\{\{\s*([^\}\s]+)\s*\}\}/g, (m, key)=>{
          const val = readKey(data, key);
          return val === undefined || val === null ? '' : String(val);
        });
      }
      function readKey(obj, path){
        try{
          return path.split('.').reduce((acc, k)=>acc && acc[k] !== undefined ? acc[k] : undefined, obj);
        }catch(e){ return undefined; }
      }

      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

      // Actions
      addToolBtn.addEventListener('click', ()=>{
        const id = uid();
        const demo = {
          id,
          name: 'Demo Tool ' + (Object.keys(tools).length + 1),
          template: 'Hello {{name}}, welcome to {{field}}.\nThis is a demo output.\nYour email: {{contact.email}}',
          desc: 'Demo generator — provide JSON input.'
        };
        tools[id] = demo;
        stats.perTool[id] = { uses:0, downloads:0 };
        saveAll();
        selectTool(id);
      });

      resetToolsBtn.addEventListener('click', ()=>{
        if(!confirm('सभी tools हटाना चाहते हैं? यह irreversible है।')) return;
        tools = {};
        stats = { totalUses:0, totalDownloads:0, perTool:{} };
        saveAll();
        clearSelection();
      });

      // Owner settings
      saveOwnerBtn.addEventListener('click', ()=>{
        owner.name = ownerName.value.trim();
        owner.links = ownerLinks.value.trim();
        saveAll();
        notify('Owner saved');
      });
      exportOwnerBtn.addEventListener('click', ()=>{
        const txt = JSON.stringify(owner, null, 2);
        downloadBlob(txt, 'owner-settings.json');
      });
      importOwnerBtn.addEventListener('click', ()=>{
        const s = prompt('Paste owner JSON here:');
        if(!s) return;
        try{
          const o = JSON.parse(s);
          owner = o;
          saveAll();
          notify('Owner imported');
        }catch(e){ alert('Invalid JSON'); }
      });
      resetOwnerBtn.addEventListener('click', ()=>{
        if(!confirm('Reset owner settings?')) return;
        owner = { name:'', links:'' };
        saveAll();
      });

      // import/export tools
      applyImportBtn.addEventListener('click', ()=>{
        const txt = importArea.value.trim();
        if(!txt){ alert('Paste exported JSON first'); return; }
        try{
          const obj = JSON.parse(txt);
          // obj can be single tool or full object {tools:..., stats:..., owner:...}
          if(obj.tools){
            tools = obj.tools;
          } else {
            // assume single tool or map
            if(obj.id && obj.name) tools[obj.id] = obj;
            else if(typeof obj === 'object') tools = Object.assign({}, tools, obj);
          }
          // optionally import stats
          if(obj.stats) stats = obj.stats;
          saveAll();
          notify('Import applied');
        }catch(e){ alert('Invalid JSON'); }
      });

      exportAllBtn.addEventListener('click', ()=>{
        const packageObj = { tools, stats, owner, exportedAt: new Date().toISOString() };
        downloadBlob(JSON.stringify(packageObj, null, 2), 'omniverse-tools-export.json');
      });

      resetAllStatsBtn.addEventListener('click', ()=>{
        if(!confirm('Reset all stats (uses & downloads)?')) return;
        stats = { totalUses:0, totalDownloads:0, perTool:{} };
        // keep tools
        Object.keys(tools).forEach(id=>stats.perTool[id] = { uses:0, downloads:0 });
        saveAll();
      });

      // select / save / delete tool
      saveToolBtn.addEventListener('click', ()=>{
        const name = toolNameIn.value.trim();
        const tpl = toolTemplateIn.value;
        const desc = toolDescIn.value.trim();
        if(!name){ alert('Tool name required'); return; }
        if(!selectedToolId){ alert('No tool selected'); return; }
        tools[selectedToolId].name = name;
        tools[selectedToolId].template = tpl;
        tools[selectedToolId].desc = desc;
        saveAll();
        notify('Tool saved');
      });

      deleteToolBtn.addEventListener('click', ()=>{
        if(!selectedToolId) return alert('Select a tool first');
        if(!confirm('Delete this tool?')) return;
        delete tools[selectedToolId];
        delete stats.perTool[selectedToolId];
        selectedToolId = null;
        saveAll();
        clearSelection();
      });

      // use tool: generate, copy, download
      generateBtn.addEventListener('click', ()=>{
        if(!selectedToolId){ alert('Select a tool'); return; }
        const raw = jsonInput.value.trim();
        let data = {};
        if(raw){
          try{ data = JSON.parse(raw); } catch(e){ alert('Invalid JSON input — देखें example'); return; }
        }
        const tpl = tools[selectedToolId].template || '';
        const out = renderTemplate(tpl, data);
        outputArea.textContent = out || '(empty output)';
        // increment stats
stats.totalUses = (stats.totalUses || 0) + 1;
stats.perTool[selectedToolId] = stats.perTool[selectedToolId] || { uses:0, downloads:0 };
stats.perTool[selectedToolId].uses = (stats.perTool[selectedToolId].uses || 0) + 1;
saveAll();
selectTool(selectedToolId); // update counts
});

clearOutput.addEventListener('click', ()=>{ outputArea.textContent = ''; });
copyOutput.addEventListener('click', ()=>{
  const txt = outputArea.textContent || '';
  navigator.clipboard?.writeText(txt).then(()=>notify('Copied')).catch(()=>alert('Copy failed'));
});

downloadOutput.addEventListener('click', ()=>{
  if(!selectedToolId){ alert('Select a tool'); return; }
  const txt = outputArea.textContent || '';
  if(!txt){ alert('No output to download'); return; }
  const filename = (tools[selectedToolId].name || 'output').replace(/\s+/g,'-').toLowerCase() + '.txt';
  downloadBlob(txt, filename);
  // stats
  stats.totalDownloads = (stats.totalDownloads || 0) + 1;
  stats.perTool[selectedToolId] = stats.perTool[selectedToolId] || { uses:0, downloads:0 };
  stats.perTool[selectedToolId].downloads = (stats.perTool[selectedToolId].downloads || 0) + 1;
  saveAll();
  selectTool(selectedToolId);
});

resetToolStatsBtn.addEventListener('click', ()=>{
  if(!selectedToolId){ alert('Select a tool'); return; }
  if(!confirm('Reset stats for this tool?')) return;
  stats.perTool[selectedToolId] = { uses:0, downloads:0 };
  saveAll();
  selectTool(selectedToolId);
});

exportToolBtn.addEventListener('click', ()=>{
  if(!selectedToolId){ alert('Select a tool'); return; }
  const obj = { tool: tools[selectedToolId], stats: stats.perTool[selectedToolId] || {} };
  downloadBlob(JSON.stringify(obj, null, 2), (tools[selectedToolId].name||'tool') + '.json');
});

// open dashboard (opens a simple aggregated report in new tab)
openDashboardBtn.addEventListener('click', ()=>{
  const report = { owner, tools, stats, generatedAt: new Date().toISOString() };
  const win = window.open('', '_blank');
  win.document.write('<pre style="font-family:monospace;white-space:pre-wrap;padding:18px;">' + escapeHtml(JSON.stringify(report, null, 2)) + '</pre>');
});

// utility to download blob
function downloadBlob(txt, filename){
  const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename;
  document.body.appendChild(a); a.click();
  setTimeout(()=>{ a.remove(); URL.revokeObjectURL(url); }, 500);
}

// initial load + render
function renderAll(){
  renderOwner();
  aggregateStats();
  renderToolsList();
}

// boot
loadState();
// ensure perTool stats exist
Object.keys(tools).forEach(id=>{ stats.perTool[id] = stats.perTool[id] || { uses:0, downloads:0 }; });
saveAll();
clearSelection();

// expose small helper to console for advanced ops
window.omniverseLocal = {
  loadState, saveAll,
  getTools: ()=>tools,
  getStats: ()=>stats,
  getOwner: ()=>owner,
};

// helper: keyboard shortcut to add demo tool (ctrl+shift+n)
window.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='n'){ addToolBtn.click(); }
});
})();
          
      
