<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Omniverse Marketplace — Local Demo</title>
<style>
  :root{--bg:#071025;--card:#081425;--muted:#9fb0d9;--accent:#60a5fa;--glass:rgba(255,255,255,0.03)}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#041227 0%, #071025 60%);color:#e6eef8}
  .wrap{max-width:1100px;margin:18px auto;padding:14px}
  header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:18px}
  .grid{display:grid;grid-template-columns:320px 1fr;gap:14px}
  .card{background:linear-gradient(180deg,var(--glass),transparent);border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:10px}
  button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:#e6eef8;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px}
  .tools-list{display:flex;flex-direction:column;gap:8px;margin-top:10px;max-height:65vh;overflow:auto}
  .tool-item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);background:rgba(0,0,0,0.02)}
  .tool-item .meta{font-size:12px;color:var(--muted)}
  textarea{width:100%;min-height:120px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#e6eef8;padding:8px;border-radius:6px;font-family:monospace}
  input[type="text"], input[type="url"]{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#e6eef8}
  .flex{display:flex;gap:8px;align-items:center}
  .badge{background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:999px;font-size:12px}
  .right-col{display:flex;flex-direction:column;gap:10px}
  .tool-panel{display:flex;flex-direction:column;gap:8px}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .center{display:flex;gap:8px;align-items:center}
  footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
  .top-row{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .hidden{display:none}
  .danger{color:#ffb4b4}
  .file-input{display:none}
  @media(max-width:880px){ .grid{grid-template-columns:1fr} .tools-list{max-height:220px} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Omniverse AI Tools Marketplace — Local Demo</h1>
        <div class="muted">Zero-cost · Donation-ready — सभी settings और stats आपके ब्राउज़र में localStorage में सुरक्षित रहते हैं</div>
      </div>
      <div style="margin-left:auto" class="center">
        <button id="btnOwner">Owner Settings</button>
        <button id="btnExportAll">Export Settings</button>
        <button id="btnImportAll">Import Settings</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: tools + admin -->
      <div>
        <div class="card">
          <div class="top-row">
            <div>
              <div class="small muted">Open Dashboard (local stats)</div>
              <strong id="ownerName">Owner: —</strong>
            </div>
            <div class="center">
              <div class="badge" id="toolsCount">Tools: 0</div>
              <div style="width:8px"></div>
              <div class="badge" id="globalStats">Downloads: 0 • Uses: 0</div>
            </div>
          </div>

          <div style="margin-top:10px" class="flex">
            <button id="btnAddDemo">+ Add Demo Tools</button>
            <button id="btnResetTools" class="danger">Reset Tools</button>
            <button id="btnResetStats" class="danger">Reset Stats</button>
          </div>

          <div class="muted" style="margin-top:10px">किसी भी टूल को चुनें, JSON input भरें और Generate दबाएँ।</div>

          <div class="tools-list" id="toolsList" aria-live="polite"></div>
        </div>

        <div class="card" style="margin-top:10px">
          <strong>Owner Settings</strong>
          <div class="muted">यह सभी settings केवल आपके ब्राउज़र में सेव होते हैं — कोई secret GitHub पर नहीं भेजें।</div>
          <div style="margin-top:8px">
            <div class="small">Owner name</div>
            <input id="inpOwner" placeholder="आपका नाम (Owner)" />
            <div class="small" style="margin-top:8px">Donate / Pay links (comma separated)</div>
            <input id="inpDonate" placeholder="upi:abc@bank, https://paypal.me/you, https://ko-fi.com/you" />
            <div style="margin-top:8px" class="flex">
              <button id="saveOwner">Save Settings</button>
              <button id="btnExportSettings">Export Settings</button>
              <button id="btnImportSettings">Import Settings</button>
              <button id="btnClearOwner" class="danger">Reset</button>
            </div>
            <div class="muted small" style="margin-top:8px">Owner settings ब्राउज़र में ही रहते हैं। Export/Import करके आप किसी और मशीन पर restore कर सकते हैं।</div>
          </div>
        </div>
      </div>

      <!-- RIGHT: details / tool editor / generate -->
      <div class="right-col">
        <div class="card">
          <div class="top-row">
            <div>
              <strong id="toolTitle">— Select a tool —</strong>
              <div class="muted" id="toolDesc">Tool description will appear here.</div>
            </div>
            <div class="center">
              <div class="muted small">Uses: <span id="toolUses">0</span></div>
              <div style="width:8px"></div>
              <div class="muted small">Downloads: <span id="toolDownloads">0</span></div>
            </div>
          </div>

          <div class="tool-panel" style="margin-top:10px">
            <div class="small muted">Enter JSON input for the selected tool</div>
            <textarea id="jsonInput" placeholder='{ "name": "Your Name", "field":"AI" }'></textarea>
            <div class="actions">
              <button id="btnGenerate">Generate</button>
              <button id="btnClear">Clear</button>
              <button id="btnCopyOutput">Copy</button>
              <button id="btnDownloadOutput">⬇️ Download</button>
              <button id="btnResetToolStats">Reset Tool Stats</button>
            </div>

            <div style="margin-top:8px">
              <div class="muted small">Tip: जितना structured JSON देंगे output उतना बेहतर होगा।</div>
            </div>

            <div style="margin-top:10px">
              <textarea id="aiOutput" readonly>AI output will appear here...</textarea>
            </div>
          </div>
        </div>

        <div class="card">
          <strong>Usage & Notes</strong>
          <div class="muted small" style="margin-top:8px">
            यह demo fully client-side है — कोई external API नहीं कॉल करता। जब आप advanced AI कॉल करना चाहें (OpenAI आदि), तो Owner Settings में API key जोड़ने का विकल्प जोड़ा जा सकेगा।<br>
            सभी settings और stats केवल आपकी मशीन पर रहते हैं — अगर आप export नहीं करेंगे तो परिवर्तन GitHub पर नहीं दिखेंगे।
          </div>
        </div>
      </div>
    </div>

    <footer>
      © Omniverse Marketplace — localStorage में settings & stats। Deploy: GitHub Pages.
    </footer>
  </div>

<script>
/*
  Omniverse Marketplace — Single-file client-side manager
  - Tools stored in localStorage under key 'omnv_tools'
  - Owner settings in 'omnv_owner'
  - Stats in 'omnv_stats'
*/

(() => {
  // localStorage keys
  const KEY_TOOLS = 'omnv_tools_v1';
  const KEY_OWNER = 'omnv_owner_v1';
  const KEY_STATS = 'omnv_stats_v1';

  // DOM
  const toolsListEl = document.getElementById('toolsList');
  const toolsCountEl = document.getElementById('toolsCount');
  const ownerNameEl = document.getElementById('ownerName');
  const globalStatsEl = document.getElementById('globalStats');

  const toolTitleEl = document.getElementById('toolTitle');
  const toolDescEl = document.getElementById('toolDesc');
  const toolUsesEl = document.getElementById('toolUses');
  const toolDownloadsEl = document.getElementById('toolDownloads');

  const jsonInputEl = document.getElementById('jsonInput');
  const generateBtn = document.getElementById('btnGenerate');
  const clearBtn = document.getElementById('btnClear');
  const aiOutputEl = document.getElementById('aiOutput');
  const copyBtn = document.getElementById('btnCopyOutput');
  const downloadBtn = document.getElementById('btnDownloadOutput');
  const resetToolStatsBtn = document.getElementById('btnResetToolStats');

  const inpOwner = document.getElementById('inpOwner');
  const inpDonate = document.getElementById('inpDonate');
  const saveOwnerBtn = document.getElementById('saveOwner');
  const btnOwner = document.getElementById('btnOwner');
  const btnExportAll = document.getElementById('btnExportAll');
  const btnImportAll = document.getElementById('btnImportAll');
  const btnAddDemo = document.getElementById('btnAddDemo');
  const btnResetTools = document.getElementById('btnResetTools');
  const btnResetStats = document.getElementById('btnResetStats');
  const btnExportSettings = document.getElementById('btnExportSettings');
  const btnImportSettings = document.getElementById('btnImportSettings');
  const btnClearOwner = document.getElementById('btnClearOwner');

  // state
  let tools = []; // array of {id, name, description, template}
  let owner = { name: '', paylinks: '' };
  let stats = { totalUses:0, totalDownloads:0, perTool: {} };
  let selectedToolId = null;

  // util
  function uid(prefix='t') { return prefix + '_' + Math.random().toString(36).slice(2,9); }

  // storage
  function loadState(){
    try { tools = JSON.parse(localStorage.getItem(KEY_TOOLS) || '[]'); } catch(e){ tools = []; }
    try { owner = JSON.parse(localStorage.getItem(KEY_OWNER) || '{"name":"","paylinks":""}'); } catch(e){ owner={name:'',paylinks:''}; }
    try { stats = JSON.parse(localStorage.getItem(KEY_STATS) || '{"totalUses":0,"totalDownloads":0,"perTool":{}}'); } catch(e){ stats={totalUses:0,totalDownloads:0,perTool:{}}; }
  }
  function saveTools(){ localStorage.setItem(KEY_TOOLS, JSON.stringify(tools)); renderTools(); }
  function saveOwner(){ localStorage.setItem(KEY_OWNER, JSON.stringify(owner)); renderOwner(); }
  function saveStats(){ localStorage.setItem(KEY_STATS, JSON.stringify(stats)); renderGlobalStats(); }

  // render
  function renderTools(){
    toolsListEl.innerHTML = '';
    tools.forEach(t=>{
      const el = document.createElement('div');
      el.className = 'tool-item';
      el.innerHTML = `<div>
          <strong>${escapeHtml(t.name)}</strong>
          <div class="meta">${escapeHtml(t.description || '')}</div>
        </div>
        <div style="display:flex;gap:6px;align-items:center">
          <div class="meta small">U:${(stats.perTool[t.id]?.uses)||0} D:${(stats.perTool[t.id]?.downloads)||0}</div>
          <button data-id="${t.id}" class="btnSelect">Open</button>
          <button data-id="${t.id}" class="btnEdit">Edit</button>
          <button data-id="${t.id}" class="btnDel">Delete</button>
        </div>`;
      toolsListEl.appendChild(el);
    });

    toolsCountEl.textContent = `Tools: ${tools.length}`;
    // wire events
    Array.from(document.getElementsByClassName('btnSelect')).forEach(b=>{
      b.onclick = ()=> selectTool(b.dataset.id);
    });
    Array.from(document.getElementsByClassName('btnEdit')).forEach(b=>{
      b.onclick = ()=> editTool(b.dataset.id);
    });
    Array.from(document.getElementsByClassName('btnDel')).forEach(b=>{
      b.onclick = ()=> { if(confirm('Delete this tool?')) deleteTool(b.dataset.id); };
    });
  }
  function renderOwner(){
    ownerNameEl.textContent = owner.name ? `Owner: ${owner.name}` : 'Owner: —';
    inpOwner.value = owner.name || '';
    inpDonate.value = owner.paylinks || '';
  }
  function renderGlobalStats(){
    globalStatsEl.textContent = `Downloads: ${stats.totalDownloads || 0} • Uses: ${stats.totalUses || 0}`;
    // selected tool stats
    if(selectedToolId){
      const p = stats.perTool[selectedToolId] || {uses:0,downloads:0};
      toolUsesEl.textContent = p.uses || 0;
      toolDownloadsEl.textContent = p.downloads || 0;
    } else {
      toolUsesEl.textContent = 0; toolDownloadsEl.textContent = 0;
    }
  }
  function renderSelectedTool(){
    const t = tools.find(x=>x.id===selectedToolId);
    if(!t){
      toolTitleEl.textContent = '— Select a tool —';
      toolDescEl.textContent = 'Tool description will appear here.';
      aiOutputEl.value = 'AI output will appear here...';
      jsonInputEl.value = '{ "name": "Your Name", "field":"AI" }';
      return;
    }
    toolTitleEl.textContent = t.name;
    toolDescEl.textContent = t.description || '—';
    jsonInputEl.value = t.exampleJson || '{ "name": "Your Name" }';
    const p = stats.perTool[t.id] || {uses:0,downloads:0};
    toolUsesEl.textContent = p.uses || 0;
    toolDownloadsEl.textContent = p.downloads || 0;
    aiOutputEl.value = 'Output will appear here...';
  }

  // actions
  function selectTool(id){
    selectedToolId = id;
    renderSelectedTool();
  }
  function addDemoTools(){
    const demo = [
      {
        id: uid('demo'),
        name: 'Resume Builder',
        description: 'Simple resume generator — template uses name, role, summary, skills.',
        template: 'Name: {{name}}\nRole: {{role}}\nSummary: {{summary}}\nSkills: {{skills}}\n\n--- Generated by Omniverse Resume Builder',
        exampleJson: JSON.stringify({name:'Ajay Kumar', role:'Frontend Developer', summary:'5 yrs experience in React.', skills:'HTML, CSS, JS, React'}, null, 2)
      },
      {
        id: uid('demo'),
        name: 'Short Bio Generator',
        description: 'One-paragraph professional bio. Uses name and specialty.',
        template: '{{name}} is a {{specialty}} who helps build great products. Contact: {{contact}}',
        exampleJson: JSON.stringify({name:'Sana',specialty:'product designer',contact:'sana@example.com'}, null, 2)
      },
      {
        id: uid('demo'),
        name: 'Website Hero HTML',
        description: 'Simple hero section HTML. Replaces title and subtitle.',
        template: '<section class=\"hero\"><h1>{{title}}</h1><p>{{subtitle}}</p></section>',
        exampleJson: JSON.stringify({title:'Omniverse', subtitle:'AI-powered microtools'}, null, 2)
      }
    ];
    tools = tools.concat(demo);
    tools.forEach(t=> { if(!stats.perTool[t.id]) stats.perTool[t.id] = {uses:0,downloads:0}; });
    saveTools(); saveStats();
    alert('Demo tools added.');
  }
  function resetTools(){
    if(!confirm('Reset all tools? This will delete all tools.')) return;
    tools = [];
    selectedToolId = null;
    saveTools();
    alert('Tools reset.');
  }
  function resetStats(){
    if(!confirm('Reset all stats?')) return;
    stats = { totalUses:0, totalDownloads:0, perTool: {} };
    saveStats(); renderGlobalStats(); alert('Stats reset.');
  }
  function deleteTool(id){
    tools = tools.filter(x=>x.id!==id);
    delete stats.perTool[id];
    if(selectedToolId===id) selectedToolId = null;
    saveTools(); saveStats();
  }

  // edit/create tool (prompt-based minimal editor)
  function editTool(id){
    let t = tools.find(x=>x.id===id);
    if(!t){
      // create new
      const name = prompt('Tool name (e.g., "Short Bio Generator")');
      if(!name) return;
      const description = prompt('Short description');
      const template = prompt('Template (use {{key}} placeholders)', 'Hello {{name}}, this is demo');
      const exampleJson = prompt('Example JSON (one-line)', '{"name":"Ajay"}') || '{}';
      const newTool = { id: uid('t'), name, description, template, exampleJson };
      tools.push(newTool);
      stats.perTool[newTool.id] = {uses:0,downloads:0};
    } else {
      const name = prompt('Tool name', t.name);
      if(!name) return;
      const description = prompt('Short description', t.description || '');
      const template = prompt('Template (use {{key}} placeholders)', t.template || '');
      const exampleJson = prompt('Example JSON', t.exampleJson || '{}');
      t.name = name; t.description = description; t.template = template; t.exampleJson = exampleJson;
    }
    saveTools(); saveStats();
  }

  // generate output from selected tool + JSON input
  function generateOutput(){
    const t = tools.find(x=>x.id===selectedToolId);
    if(!t){ alert('पहले कोई टूल चुनें।'); return; }
    let data;
    try {
      data = JSON.parse(jsonInputEl.value);
    } catch(e){
      alert('Invalid JSON: ' + e.message);
      return;
    }
    // simple templating: replace {{key}} with value
    let out = t.template || '';
    // if template empty, try to pretty-print JSON
    if(!out || out.trim()==='') out = JSON.stringify(data, null, 2);

    // replace placeholders
    out = out.replace(/\{\{\s*([a-zA-Z0-9_\.]+)\s*\}\}/g, (m,k)=>{
      // support nested keys like person.name
      const val = k.split('.').reduce((acc,part)=>acc && acc[part], data);
      return (val===undefined || val===null) ? '' : String(val);
    });

    // fallback: if still contains placeholders and data has keys, append JSON
    if(out.includes('{{')) {
      out += '\n\n---\n' + JSON.stringify(data, null, 2);
    }

    // increment stats
    stats.totalUses = (stats.totalUses||0) + 1;
    stats.perTool[t.id] = stats.perTool[t.id] || {uses:0,downloads:0};
    stats.perTool[t.id].uses = (stats.perTool[t.id].uses||0) + 1;
    saveStats();

    aiOutputEl.value = out;
    renderGlobalStats();
  }

  // download output
  function downloadOutput(){
    const t = tools.find(x=>x.id===selectedToolId);
    if(!t){ alert('पहले कोई टूल चुनें।'); return; }
    const content = aiOutputEl.value || '';
    if(!content){ alert('कोई output नहीं — Generate करें पहले।'); return; }
    const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
    const name = (t.name.replace(/\s+/g,'_') || 'omniv_output') + '.txt';
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);

    stats.totalDownloads = (stats.totalDownloads||0) + 1;
    stats.perTool[t.id] = stats.perTool[t.id] || {uses:0,downloads:0};
    stats.perTool[t.id].downloads = (stats.perTool[t.id].downloads||0) + 1;
    saveStats();
    renderGlobalStats();
  }

  // copy to clipboard
  async function copyOutput(){
    const text = aiOutputEl.value || '';
    if(!text){ alert('कोई output नहीं — Generate करें पहले।'); return; }
    try {
      await navigator.clipboard.writeText(text);
      alert('Copied to clipboard');
    } catch(e){
      // fallback
      aiOutputEl.select();
      document.execCommand('copy');
      alert('Copied (fallback)');
    }
  }

  // reset selected tool stats
  function resetSelectedToolStats(){
    if(!selectedToolId) return alert('कोई tool selected नहीं।');
    if(!confirm('Reset stats for selected tool?')) return;
    if(stats.perTool[selectedToolId]) stats.perTool[selectedToolId] = {uses:0,downloads:0};
    saveStats(); renderGlobalStats();
  }

  // import/export
  function exportAll(){
    const payload = { tools, owner, stats, exportedAt: new Date().toISOString() };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'omniverse-export.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function importAllFile(){
    const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
    inp.onchange = e => {
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = ev => {
        try {
          const data = JSON.parse(ev.target.result);
          if(data.tools) tools = data.tools;
          if(da
