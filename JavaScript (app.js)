// AI Run function using OpenAI (example)
async function runTool(){
  if(selectedIndex===null) return alert('Select a tool first.');
  const tool = tools[selectedIndex];
  const textarea = document.getElementById('tool-output');
  textarea.value = "Generating AI output...";
  
  const prompt = tool.generatorPrompt || `Generate content for ${tool.name}`;
  
  try{
    // Example: OpenAI API call
    const apiKey = localStorage.getItem('omniverse_openai_key'); // user must add key in settings
    if(!apiKey) return textarea.value="Add OpenAI API key in Owner Settings to run AI.";
    
    const response = await fetch("https://api.openai.com/v1/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":`Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: "text-davinci-003",
        prompt: prompt,
        max_tokens: 200
      })
    });
    
    const data = await response.json();
    textarea.value = data.choices[0].text.trim();
    
  }catch(e){
    textarea.value = "Error generating AI output: " + e.message;
  }
}
// Load saved settings
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("paytm").href = localStorage.getItem("paytmLink") || "#";
    document.getElementById("paypal").href = localStorage.getItem("paypalLink") || "#";
});

// Open / Close Settings Modal
document.getElementById("openSettings").onclick = () => {
    document.getElementById("settingsModal").style.display = "block";
};
document.getElementById("closeSettings").onclick = () => {
    document.getElementById("settingsModal").style.display = "none";
};

// Save Premium Key
document.getElementById("saveKey").onclick = () => {
    const key = document.getElementById("premiumKeyInput").value;
    localStorage.setItem("premiumKey", key);
    alert("Premium key saved!");
};

// Save Payment Links
document.getElementById("savePaytm").onclick = () => {
    localStorage.setItem("paytmLink", document.getElementById("paytmLink").value);
    alert("Paytm link saved!");
};
document.getElementById("savePaypal").onclick = () => {
    localStorage.setItem("paypalLink", document.getElementById("paypalLink").value);
    alert("PayPal link saved!");
};

// Generate AI output (demo text for now)
document.getElementById("generateBtn").onclick = () => {
    document.getElementById("outputArea").value =
        "This is your AI generated output.\nCustom tools will be added next.";
};

// Clear
document.getElementById("clearBtn").onclick = () => {
    document.getElementById("toolInput").value = "";
    document.getElementById("outputArea").value = "";
};

// Download file
document.getElementById("downloadBtn").onclick = () => {
    const text = document.getElementById("outputArea").value;
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "ai-output.txt";
    a.click(// app.js - Omniverse Marketplace (basic behavior + local owner settings)

// --- Defaults from you (pre-filled) ---
const DEFAULT_PAYPAL = "https://paypal.me/sainirampaul60"; // paypal.me uses username; alternative: paypal link via email if needed
const DEFAULT_PAYPAL_ALT = "https://www.paypal.com/paypalme/sainirampaul60";
const DEFAULT_PAYPAL_EMAIL = "sainirampaul60@gmail.com";

const DEFAULT_PAYTM_PHONE = "8082935186";
// Attempt a simple user-friendly Paytm link (paytm.me style). If you use official deep link, change in settings.
const DEFAULT_PAYTM_LINK = `https://paytm.me/${DEFAULT_PAYTM_PHONE}`;

// Utility to get from localStorage or default
function getPaytmLink(){ return localStorage.getItem('paytmLink') || DEFAULT_PAYTM_LINK; }
function getPaypalLink(){ return localStorage.getItem('paypalLink') || ("https://paypal.me/" + (localStorage.getItem('paypalUser') || 'sainirampaul60')); }

function initPaymentButtons(){
  const paytmEl = document.getElementById('paytm');
  const paypalEl = document.getElementById('paypal');
  paytmEl.href = getPaytmLink();
  paypalEl.href = getPaypalLink();

  // show phone/email in title for user's awareness
  paytmEl.title = "Paytm: " + DEFAULT_PAYTM_PHONE;
  paypalEl.title = "PayPal: " + DEFAULT_PAYPAL_EMAIL;
}

// Owner settings modal controls
const settingsModal = document.getElementById('settingsModal');
document.getElementById('openSettings').onclick = () => {
  // prefill inputs from localStorage or defaults
  document.getElementById('premiumKeyInput').value = localStorage.getItem('premiumKey') || '';
  document.getElementById('paytmLink').value = localStorage.getItem('paytmLink') || DEFAULT_PAYTM_LINK;
  document.getElementById('paypalLink').value = localStorage.getItem('paypalLink') || DEFAULT_PAYPAL;
  settingsModal.style.display = 'flex';
};
document.getElementById('closeSettings').onclick = () => settingsModal.style.display = 'none';

// Save premium key
document.getElementById('saveKey').onclick = () => {
  const v = document.getElementById('premiumKeyInput').value.trim();
  if(v.length === 0){ alert('Premium key cleared.'); localStorage.removeItem('premiumKey'); return; }
  localStorage.setItem('premiumKey', v);
  alert('Premium key saved locally.');
};
document.getElementById('clearKey').onclick = () => {
  localStorage.removeItem('premiumKey');
  document.getElementById('premiumKeyInput').value = '';
  alert('Premium key removed.');
};

// Save payment links
document.getElementById('savePayLinks').onclick = () => {
  const p = document.getElementById('paytmLink').value.trim();
  const q = document.getElementById('paypalLink').value.trim();
  if(p) localStorage.setItem('paytmLink', p);
  if(q) localStorage.setItem('paypalLink', q);
  initPaymentButtons();
  alert('Payment links saved locally.');
};
document.getElementById('resetPayLinks').onclick = () => {
  localStorage.removeItem('paytmLink');
  localStorage.removeItem('paypalLink');
  initPaymentButtons();
  alert('Payment links reset to defaults.');
};

// Generate (demo) - replace with real AI call later
document.getElementById('generateBtn').onclick = () => {
  const input = document.getElementById('toolInput').value.trim();
  // Basic JSON parse attempt for structured tools
  let parsed = null;
  try{ parsed = JSON.parse(input); } catch(e){ /* ignore */ }
  const name = parsed && parsed.name ? parsed.name : 'User';
  const field = parsed && parsed.field ? parsed.field : 'Field';
  const out = `Resume — ${name}\nField: ${field}\n\nProfessional Summary:\nA motivated ${field} professional named ${name}... (demo output)\n\n[This is demo content. Connect a real AI endpoint to generate real content.]`;
  document.getElementById('outputArea').value = out;

  // increment uses count
  const uses = Number(localStorage.getItem('usesCount') || 0) + 1;
  localStorage.setItem('usesCount', uses);
  document.getElementById('usesCount').textContent = uses;
};

// Clear
document.getElementById('clearBtn').onclick = () => {
  document.getElementById('toolInput').value = '';
  document.getElementById('outputArea').value = '';
};

// Download
document.getElementById('downloadBtn').onclick = () => {
  const txt = document.getElementById('outputArea').value;
  if(!txt){ alert('No output to download'); return; }
  const blob = new Blob([txt], {type: 'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'omniverse-output.txt';
  a.click();
  // increment downloads
  const d = Number(localStorage.getItem('downloadCount') || 0) + 1;
  localStorage.setItem('downloadCount', d);
  document.getElementById('downloadCount').textContent = d;
};

// On load: init counters & links
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('usesCount').textContent = localStorage.getItem('usesCount') || 0;
  document.getElementById('downloadCount').textContent = localStorage.getItem('downloadCount') || 0;
  initPaymentButtons();
});

// Open local dashboard (just an example showing local stats)
document.getElementById('openDashboard').onclick = () => {
  alert('Local stats:\\nUses: ' + (localStorage.getItem('usesCount')||0) + '\\nDownloads: ' + (localStorage.getItem('downloadCount')||0));
};
document.getElementById('openLocalStats').onclick = () => document.getElementById('openDashboard').click();

// Premium unlock: check saved key
document.getElementById('unlockBtn').onclick = () => {
  const saved = localStorage.getItem('premiumKey') || '';
  const provided = prompt('Enter premium key to unlock:') || '';
  if(!saved){ alert('No premium key set. Go to Owner Settings to set one.'); return; }
  if(provided === saved){ alert('Premium unlocked! (demo) — now you would get premium output.'); } else { alert('Invalid key.'); }
};
);
};
